<view class="container">

  <!-- â•â•â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â•â•â• -->
  <view class="header">

    <!-- Row 1: City + Date + Nights -->
    <view class="header-row1">
      <picker mode="selector" range="{{cities}}" bindchange="onCityChange">
        <view class="city-btn">
          <text class="city-text">{{query.city || 'åŸå¸‚'}}</text>
          <text class="caret">â–¾</text>
        </view>
      </picker>

      <view class="divider-v"></view>

      <view class="date-block">
        <picker mode="date" value="{{query.checkIn}}" bindchange="onCheckInChange">
          <view class="date-item">
            <text class="date-label">å…¥ä½</text>
            <text class="date-val">{{query.checkInShort}}</text>
          </view>
        </picker>
        <view class="nights-badge">
          <text>{{nights}}æ™š</text>
        </view>
        <picker mode="date" value="{{query.checkOut}}" bindchange="onCheckOutChange">
          <view class="date-item">
            <text class="date-label">ç¦»åº—</text>
            <text class="date-val">{{query.checkOutShort}}</text>
          </view>
        </picker>
      </view>
    </view>

    <!-- Row 2: Search -->
    <view class="search-row">
      <view class="search-box" bindtap="openSearch">
        <text class="search-icon">ğŸ”</text>
        <text class="search-placeholder">{{query.keyword || 'é…’åº—å/ä½ç½®/å“ç‰Œ'}}</text>
      </view>
      <view class="search-clear" wx:if="{{query.keyword}}" bindtap="clearKeyword">âœ•</view>
    </view>

    <!-- Row 3: Filter tabs -->
    <view class="filter-tabs">
      <view class="filter-tab {{activeFilter==='sort' ? 'tab-active' : ''}}" data-type="sort" bindtap="onFilterTap">
        <text>{{currentSortLabel}}</text>
        <text class="tab-caret {{activeFilter==='sort' ? 'caret-up' : ''}}">â–¾</text>
      </view>
      <view class="filter-tab {{activeFilter==='priceStar' ? 'tab-active' : ''}} {{(selectedPriceRange || selectedStar) ? 'tab-selected' : ''}}" data-type="priceStar" bindtap="onFilterTap">
        <text>ä»·æ ¼/æ˜Ÿçº§</text>
        <text class="tab-caret {{activeFilter==='priceStar' ? 'caret-up' : ''}}">â–¾</text>
      </view>
      <view class="filter-tab {{activeFilter==='more' ? 'tab-active' : ''}} {{selectedFacilities.length ? 'tab-selected' : ''}}" data-type="more" bindtap="onFilterTap">
        <text>æ›´å¤šç­›é€‰</text>
        <text wx:if="{{selectedFacilities.length}}" class="filter-badge">{{selectedFacilities.length}}</text>
      </view>
    </view>
  </view>

  <!-- â•â•â•â•â•â•â•â•â•â• FILTER PANELS â•â•â•â•â•â•â•â•â•â• -->

  <!-- Overlay mask -->
  <view wx:if="{{activeFilter}}" class="overlay-mask" bindtap="closeFilter"></view>

  <!-- Sort Panel -->
  <view class="filter-panel {{activeFilter==='sort' ? 'panel-show' : ''}}">
    <view class="panel-title">æ’åºæ–¹å¼</view>
    <view class="sort-options">
      <view
        wx:for="{{sortOptions}}" wx:key="key"
        class="sort-opt {{currentSort===item.key ? 'sort-opt-active' : ''}}"
        data-sort="{{item.key}}" data-label="{{item.label}}" bindtap="onSortSelect">
        <text>{{item.label}}</text>
        <text wx:if="{{currentSort===item.key}}" class="check-icon">âœ“</text>
      </view>
    </view>
  </view>

  <!-- Price/Star Panel -->
  <view class="filter-panel {{activeFilter==='priceStar' ? 'panel-show' : ''}}">
    <view class="panel-title">ä»·æ ¼åŒºé—´ï¼ˆÂ¥/æ™šï¼‰</view>
    <mobile-range-slider
      min="50"
      max="1000"
      step="50"
      low="{{selectedPriceRange ? selectedPriceRange.min : 50}}"
      high="{{selectedPriceRange ? selectedPriceRange.max : 1000}}"
      bindchange="onFilterPriceRangeChange"
    />

    <view class="panel-title" style="margin-top:30rpx">æ˜Ÿçº§è¦æ±‚</view>
    <view class="chip-row">
      <view
        wx:for="{{[3,4,5]}}" wx:key="*this"
        class="chip star-chip {{selectedStar===item ? 'chip-active' : ''}}"
        data-star="{{item}}" bindtap="onStarSelect">
        <text>{{item}}æ˜Ÿ</text>
        <text class="star-emoji">â˜…</text>
      </view>
    </view>

    <view class="panel-footer">
      <view class="btn-reset" bindtap="resetPriceStar">é‡ ç½®</view>
      <view class="btn-confirm" bindtap="applyFilter">ç¡® å®š</view>
    </view>
  </view>

<<<<<<< HEAD
  <assistant-float iconSrc="/components/assets/ai.jpg" />
=======
  <!-- More Filter Panel -->
  <view class="filter-panel {{activeFilter==='more' ? 'panel-show' : ''}}">
    <view class="panel-title">è®¾æ–½/æœåŠ¡</view>
    <view class="chip-row">
      <view
        wx:for="{{facilities}}" wx:key="*this"
        class="chip {{selectedFacilities.indexOf(item) !== -1 ? 'chip-active' : ''}}"
        data-index="{{index}}" bindtap="toggleFacility">
        {{item}}
      </view>
    </view>
    <view class="panel-footer">
      <view class="btn-reset" bindtap="resetMore">é‡ ç½®</view>
      <view class="btn-confirm" bindtap="applyFilter">ç¡® å®š</view>
    </view>
  </view>

  <!-- Search Input Modal -->
  <view wx:if="{{showSearchInput}}" class="search-modal" catchtap="noop">
    <view class="search-modal-inner">
      <input
        class="search-modal-input"
        placeholder="æœç´¢é…’åº—å/ä½ç½®/å“ç‰Œ"
        value="{{query.keyword}}"
        focus="{{true}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
      <view class="search-modal-btn" bindtap="onSearchConfirm">æœç´¢</view>
      <view class="search-modal-cancel" bindtap="closeSearch">å–æ¶ˆ</view>
    </view>
  </view>

  <!-- â•â•â•â•â•â•â•â•â•â• HOTEL LIST â•â•â•â•â•â•â•â•â•â• -->
  <scroll-view
    class="list-scroll"
    scroll-y
    bindscrolltolower="onReachBottom"
    lower-threshold="100"
  >
    <!-- Result Count -->
    <view class="result-count" wx:if="{{!loading || items.length > 0}}">
      å…±æ‰¾åˆ° <text class="count-num">{{total}}</text> å®¶é…’åº—
    </view>

    <!-- Hotel Cards -->
    <view
      class="hotel-card"
      wx:for="{{items}}"
      wx:key="id"
      data-id="{{item.id}}"
      bindtap="onItemTap"
    >
      <!-- Cover Imageï¼ˆæ— å›¾æ—¶å ä½ï¼‰ -->
      <view class="card-img-wrap">
        <image class="card-img" src="{{item.cardImage || '/components/assets/ai.png'}}" mode="aspectFill" lazy-load></image>
        <view class="star-ribbon">
          <text wx:for="{{item.starArr}}" wx:key="*this" class="star-icon">â˜…</text>
        </view>
        <view class="hot-tag" wx:if="{{item.score >= 4.8}}">äººæ°”çˆ†æ¬¾</view>
      </view>

      <!-- Info -->
      <view class="card-body">
        <view class="card-name">{{item.nameZh || item.nameEn || 'æœªå‘½åé…’åº—'}}</view>

        <view class="card-score-row" wx:if="{{item.score != null}}">
          <view class="score-pill">{{item.score}}</view>
          <view class="score-desc">
            <text class="score-label">{{item.scoreLabel}}</text>
            <text class="score-count"> Â· {{item.reviewCount}}æ¡è¯„ä»·</text>
          </view>
        </view>

        <view class="card-addr">
          <text class="addr-icon">ğŸ“</text>
          <text class="addr-text">{{item.city || ''}} Â· {{item.address || ''}}</text>
        </view>

        <view class="card-tags" wx:if="{{item.topFacilities && item.topFacilities.length}}">
          <text class="tag-item" wx:for="{{item.topFacilities}}" wx:key="*this">{{item}}</text>
        </view>

        <view class="card-price-row">
          <view class="price-left">
            <text class="price-from">ï¿¥</text>
            <text class="price-num">{{item.minPrice}}</text>
            <text class="price-unit">/æ™šèµ·</text>
          </view>
          <view class="book-btn">ç«‹å³é¢„è®¢</view>
        </view>
      </view>
    </view>

    <!-- Loading / End / Error -->
    <view class="list-footer" wx:if="{{loading}}">
      <view class="loading-dots">
        <view class="dot dot1"></view>
        <view class="dot dot2"></view>
        <view class="dot dot3"></view>
      </view>
      <text>åŠ è½½ä¸­...</text>
    </view>
    <view class="list-footer no-more" wx:elif="{{!hasMore && items.length > 0}}">
      â€” å·²åŠ è½½å…¨éƒ¨ {{items.length}} å®¶é…’åº— â€”
    </view>
    <view class="list-footer empty" wx:elif="{{!loading && items.length === 0}}">
      <text class="empty-icon">ğŸ¨</text>
      <text>æš‚æ— ç¬¦åˆæ¡ä»¶çš„é…’åº—</text>
    </view>
    <view class="list-footer error-tip" wx:if="{{error}}" bindtap="loadMore">
      {{error}} Â· ç‚¹å‡»é‡è¯•
    </view>
  </scroll-view>

  <assistant-float iconSrc="/components/assets/ai.png" />
>>>>>>> 19ed3f848632e3e714d7b091c1c792208143813f
</view>
